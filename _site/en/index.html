<!DOCTYPE html><html lang=""><head><link rel="stylesheet" href="/css/dashboard.css">
    <link
      rel="alternate"
      hreflang="fr"
      href="/fr/" /> <script src="/js/vue/dist/vue.global.js"></script>
<script src="/js/main.js"></script>
<script type="module">
window.addEventListener('load', function() {
  const { createApp } = Vue;
  const { api, constants, types } = silex;
  const {
    ConnectorType,
  } = types
  const {
    ApiError, 
    connectorList,
    getUser,
    logout,
    publicationStatus,
    publish,
    websiteAssetsLoad,
    websiteAssetsSave,
    websiteDelete,
    websiteList,
    websiteLoad,
    websiteSave,
    websiteCreate,
    websiteMetaRead,
    websiteMetaWrite,
  } = api

  const App = {
    data() {
      return {
        websites: [],
        newWebsiteName: '',
        showCreationForm: false,
        error: null,
        message: null,
        loggedIn: false,
        loading: true,
        storage: null,
        user: null,
        showMenu: false,
      }
    },
    mounted() {
      this.init()
    },

    methods: {
      async init() {
        try {
          this.user = await getUser({type: ConnectorType.STORAGE})
          if(this.user) {
            this.loggedIn = true
            this.websites = await websiteList({connectorId: this.user.connector.connectorId})
            this.loading = false
          } else {
            this.openLogin()
          }
        } catch (error) {
          console.error(error)
          this.loading = false
          if(error.code === 401) {
            this.loggedIn = false
            this.openLogin()
          } else {
            this.error = error
          }
        }
      },

      openLogin(id, lang) {
        //throw new Error('debug')
        window.open('./login/', '_self')
      },

      openEditor(id, lang) {
        window.open(`/?id=${id}&lang=${lang}`)
      },

      async logout() {
        await logout({
          type: ConnectorType.STORAGE,
          connectorId: this.user.connector.connectorId,
        })
      },

      async createWebsite() {
        if (!this.newWebsiteName) throw new Error('You need to provide a website name')
        this.loading = true
        try {
          const websiteId = this.newWebsiteName.replace(/[/\\?%*:|"<>]/g, '_')
          const result = await websiteCreate({
            websiteId,
            data: {
              name: this.newWebsiteName,
              imageUrl: null,
            },
            connectorId: this.user.connector.connectorId
          })
          this.message = 'Website created successfully'
          this.newWebsiteName = ''
          this.showCreationForm = false;
          this.websites = await websiteList({connectorId: this.user.connector.connectorId})
          this.loading = false
          return result
        } catch (error) {
          this.loading = false
          console.error(error)
          this.error = 'Failed to create website'
        }
      },

      async deleteWebsite(websiteId) {
        const ok = confirm('Deleting a website? Are your sure? Really?')
        if (!ok) return
        this.loading = true
        try {
          const result = await websiteDelete({websiteId, connectorId: this.user.connector.connectorId})
          this.message = 'Website deleted successfully'
          this.websites = await websiteList({connectorId: this.user.connector.connectorId})
          this.loading = false
          return result
        } catch (error) {
          this.loading = false
          this.error = 'Failed to delete website'
        }
      },

      async renameWebsite(websiteId) {
        const website = this.websites.find(w => w.websiteId === websiteId)
        console.log({website})
        console.log('New name for this website', website.name)
        const name = prompt('New name for this website', website.name)
        if (!name) return
        this.loading = true
        try {
          const result = await websiteMetaWrite({websiteId, connectorId: this.user.connector.connectorId, data: { name }})
          this.message = 'Website renamed successfully'
          this.websites = await websiteList({connectorId: this.user.connector.connectorId})
          this.loading = false
          return result
        } catch (error) {
          this.loading = false
          this.error = 'Failed to delete website'
        }
      },
    },
  };

  // Start vue app
  createApp(App).mount('.app');
})
</script><style>.button{cursor:pointer}a{text-decoration:none}a:hover{text-decoration:underline}.skeleton-anim:after{width:100%;height:100%;position:absolute;top:0;left:0;content:"";background:linear-gradient(.25turn,transparent,rgba(255,255,255,.75),transparent),linear-gradient(transparent,transparent),radial-gradient(38px circle at 19px 19px,transparent 50%,transparent 51%),linear-gradient(transparent,transparent);background-repeat:no-repeat;background-size:315px 250px,315px 180px,100px 100px,225px 30px;background-position:-315px 0,0 0,0 190px,50px 195px;animation:loading 1.5s infinite}@keyframes loading{to{background-position:200% 0,0 0,0 190px,50px 195px}}</style><title>Silex Dashboard</title><link rel="icon" href=""><meta property="description" content=""><meta property="og:title" content=""><meta property="og:description" content=""><meta property="og:image" content=""></head><body id="ik0i" class="body loading app"><header id="igrg" class="header padding-normal"><a id="igvu43" href="/"><img id="ir7s" src="/assets/silex-icon-2018@200px.png" href="" class="nav__logo"></a><nav id="i9jq" class="nav"><a id="iels" href="/" class="nav__item active" target="">Sites</a><a id="iels" href="http://docs.silex.me/" class="nav__item " target="_blank">Docs</a><a id="iels" href="https://www.silex.me/" class="nav__item " target="_blank">About</a><a id="iels" href="https://mail-list.silexlabs.org/subscription/cemnfkaVrK?locale=en-US&source=silex-dashboard" class="nav__item " target="_blank">News</a></nav><div id="i2red7" class="lang h-space"><a href="/en" id="iciz" class="lang__item nav__item active" hreflang="en">en</a><a href="/fr" id="iciz" class="lang__item nav__item " hreflang="fr">fr</a></div><div id="i24ew" class="user-icon__wrapper" @mouseover="showMenu = true" @mouseout="showMenu = false"><div class="user-icon" v-if="user" v-show="!showMenu" :style="`background: url(${user.picture}); background-repeat: no-repeat; background-size: contain;`"></div><div v-show="showMenu && !user.connector.disableLogout"><div class="button button--secondary" @click="logout()" v-if="user">Logout</div></div></div></header><main id="iz63r" class="padding-normal section"><h1 id="itp1f">Welcome back!</h1><div id="iyex8" class="subtitle color--light">Dive into your projects or kickstart a new one</div><div id="ickx4" class="button-bar margin-20"><button id="i2x0l" class="button button--primary rounded top-space-40" @click="showCreationForm = !showCreationForm" v-if="!showCreationForm"><span id="ibsgw" class="icon-font">+</span><span id="itl2n8">Create website</span></button><div id="i0ro3" class="button button--secondary rounded">Import</div></div><div id="ihwwxz" class="box top-space-40" v-if="showCreationForm"><h3 id="i3gd1b" class="box__header">Create a new website</h3><form method="get" id="i50acf" class="form" @submit.prevent="createWebsite"><div id="igtg1t" class="v-space"><label id="i1nmbc" class="v-space">Website name</label><input type="text" id="ij5iwh" placeholder="My project website" class="input full-width" v-model="newWebsiteName"></div><div id="ie0xes"><button type="submit" id="i021na" class="button rounded button--primary right-space">Create</button><button type="reset" class="button rounded button--secondary" @click="showCreationForm = !showCreationForm">Cancel</button></div></form></div><div id="if80m"><section id="idgvg" class="button-bar button-bar--full-width bg-white rounded loaded__item" v-if="!loading" v-for="(website, index) in websites" :key="index"><h3 id="i69a7" class="button-bar_item button-bar__item--main" v-text="website.name || website.id">My first website</h3><p id="i65hn" class="button-bar_item button-bar__item--secondary flex-no-shrink" v-text="'Updated ' + new Date(website.updatedAt).toLocaleDateString(undefined, { day: 'numeric', month: 'long', year: 'numeric' })">Updated 1h ago by lexoyo</p><p id="i64qa" class="button-bar_item button-bar__item--secondary flex-no-shrink" v-text="'Created ' + new Date(website.createdAt).toLocaleDateString(undefined, { day: 'numeric', month: 'long', year: 'numeric' })">Created 2023-02-16 by lexoyo</p><div id="i3b4tr" class="button-bar_item flex-no-shrink"><button id="ifyf6p" href="" class="button rounded button--primary button--small right-space" @click="openEditor(website.websiteId, 'en')">Edit</button><button href="" class="button rounded button--small right-space button--tertiary" @click="renameWebsite(website.websiteId, 'en')">Rename</button><button id="iol4h" class="button rounded button--small button--tertiary" @click="deleteWebsite(website.websiteId)" title="Delete">X</button></div></section><section id="i1fjn" class="button-bar button-bar--full-width bg-white rounded loading__item skeleton-anim skeleton-wrapper" v-if="loading"><h3 class="button-bar_item button-bar__item--main skeleton-text skeleton">My first websiteMy first websiteMy first websiteMy first</h3><p class="button-bar_item button-bar__item--secondary skeleton-text skeleton">Updated 1h ago by lexoyo</p><p class="button-bar_item button-bar__item--secondary skeleton-text skeleton">Created 2023-02-16 by lexoyo</p><div id="ixz6c" class="button-bar_item skeleton skeleton-button">Edit</div></section><section id="iwxxo5" class="button-bar button-bar--full-width bg-white rounded loading__item skeleton-anim skeleton-wrapper" v-if="loading"><h3 class="button-bar_item button-bar__item--main skeleton-text skeleton">My first websiteMy first websiteMy first websiteMy first</h3><p class="button-bar_item button-bar__item--secondary skeleton-text skeleton">Updated 1h ago by lexoyo</p><p class="button-bar_item button-bar__item--secondary skeleton-text skeleton">Created 2023-02-16 by lexoyo</p><div id="i9fx3l" class="button-bar_item skeleton skeleton-button">Edit</div></section><section id="isld3r" class="button-bar button-bar--full-width bg-white rounded loading__item skeleton-anim skeleton-wrapper" v-if="loading"><h3 class="button-bar_item button-bar__item--main skeleton-text skeleton">My first websiteMy first websiteMy first websiteMy first</h3><p class="button-bar_item button-bar__item--secondary skeleton-text skeleton">Updated 1h ago by lexoyo</p><p class="button-bar_item button-bar__item--secondary skeleton-text skeleton">Created 2023-02-16 by lexoyo</p><div id="i8oes3" class="button-bar_item skeleton skeleton-button">Edit</div></section><section id="iqmx38" class="button-bar button-bar--full-width bg-white rounded loading__item skeleton-anim skeleton-wrapper" v-if="loading"><h3 class="button-bar_item button-bar__item--main skeleton-text skeleton">My first websiteMy first websiteMy first websiteMy first</h3><p class="button-bar_item button-bar__item--secondary skeleton-text skeleton">Updated 1h ago by lexoyo</p><p class="button-bar_item button-bar__item--secondary skeleton-text skeleton">Created 2023-02-16 by lexoyo</p><div id="ie83jl" class="button-bar_item skeleton skeleton-button">Edit</div></section></div><div id="i7ej6j" class="box horizontal" v-if="error"><div id="iv0eyi" class="full-width v-space h-space" v-text="error">Insert your text here</div><div id="i4656n" class="button rounded button--small button--tertiary" @click="error = null">Dismiss</div></div><div id="ilteie" class="box horizontal" v-if="message"><div id="i2d31v" class="full-width v-space h-space" v-text="message">Insert your text here</div><div id="i2urco" class="button rounded button--small button--tertiary" @click="message = null">Dismiss</div></div></main><footer id="ilzpl" class="header footer"><div id="i238z" class="section"></div></footer></body></html>